# linux命令行与shell编程_第11章

> 构建基本脚本

## 使用多个命令

使用多个命令时，可以讲多个命令串起来用分号“；”隔开

```bash
$ date ; who
```

## 创建shell脚本

### shell脚本第一行

```bash
#!/bin/bash
```

- shell脚本中使用#做注释
- shell脚本第一行必须是#!开头标明脚本要用什么来执行

### 环境变量

写好脚本下面就需要让bash shell找到脚本，有两种方法

- 将shell脚本所在目录添加到环境变量$PATH中

```bash
$ export PATH=$PATH:~/tmp/ 
$ echo export PATH=$PATH:~/tmp >> ~/.bashrc
$ source ~/.bashrc 
```

- 使用绝对路径或者相对路径使用shell脚本

```bash
$ /bin/bash test.sh
$ chmod 755 test.sh
$ ./test.sh
```

### 添加可执行权限

```bash
$ chmod 755 test.sh
```

## 显示消息

- echo命令，可以将内容输出到显示器上
- -n选项，可以使字符串都在一行

```bash
#!/bin/bash

echo -n "date: $date"
```

## 使用变量

### 环境变量

> shell维护着一组环境变量用来记录特定的系统信息

- set命令可显现出当前环境变量
- 脚本中美元符号的出现就是要引用变量，如果是真正的美元符号，可以加上反斜线转义

### 用户变量

> 除了环境变量，shell允许用户自定义自己的变量

用户变量可以是任何字母数字和下划线组成的文本字符串，长度不超过20；用户变量区分大小写；使用等号将值赋值给变量，注意等号两侧不能有空格

### 命令替换

> 将命令的输出赋值给某一变量

- test=`date`，用反引号将命令括起来
- test=$(date),用美元符号小括号将命令括起来

date命令的格式化--`date +%y-%m-%d`

## 重定向输入和输出

### 输出重定向

输出重定向就是将输出内容输出到文件等非显示屏的地方

- `date > test`以覆盖的形式将命令添加到test文件
- `who >> test`以追加的形式将命令添加到test文件

### 输入重定向

输入重定向的进程和输出重定向是相反的，是将文件中的内容输出到命令

- wc命令可以对数据进行计数，包括文本的行数，词数，字节数

```bash
$ wc < test
```

- 内联输入重定向

```bash
command << marker
data  # 数据内容都会传给command，直到遇到标记marker
marker 
```

## 管道

管道符号`|`会将前一个命令的输出作为后一个命令的输入

```bash
cat test | wc
```

管道的常用方法是和more命令一起使用

## 执行数学运算

- expr命令

expr命令允许在命令行处理数学运算

```bash
$ expr 1 +　５
```

支持基本的数学运算，包括`＋；－；×；％；>；<；|；&等`

- 使用方括号

使用方括号包裹简单的数学运算`$[ 1 + 5 ]`

- 浮点解决方案

前两种方法只能解决整型的问题，不能解决浮点数

使用bc--bash计算器

支持数字、变量、注释、表达式、编程语句(if-then)和函数

　- 浮点`scale`变量控制，`scale=4`就是到小数点后4位
  - 脚本中使用bc可以结合重定向输入输出和管道符进行操作

## 退出脚本

- 查看推出状态码

```bash
$ echo $? 查看上一个命令的推出状态码
```

常见的推出状态码

状态码|描述
-|-
0|命令成功
1|一般未知性错误
2|不适合的shell命令
126|命令不执行
127|没找到命令
128|无效的退出参数
130|ctrl+c取消的命令
255|正常范围以外的状态码


- exit命令

```bash
$ exit [状态码] 
# 状态码可以是数字，也可以是一个变量，最大状态码255，如果指定的大于255，将除以256求余数作为状态码
```


---

<div align="right">**[↑ TOP](#title?)**</div>

<table>
<tr>
<td align="center">**[上一节](#!linux/linux_shell/linux_?.md)**</td>
<td align="center">**[下一节](#!linux/linux_shell/linux_?.md)**</td>
</tr>
</table>
